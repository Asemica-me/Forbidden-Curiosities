<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Items</title>
    <style>
        /* General reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
    
        }
        
        body {
            flex-direction: column;
            background-color: #111;
            min-height: 100vh;
            color: #f0f0f0;
            margin: 0;
        }

        main {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Divider line after the navbar */
        .divider {
            width: 100vw; /* Full width of the viewport */
            height: 1px;
            background-color: red;
            margin: 10px 0;
        }

        .d-none {
    display: none;
}

/* navbar styling */

.navbar {
    background-color: #333;
    padding: 1rem;
}

.nav-links .logo {
    font-size: 24px;
    font-weight: bold; /* Grassetto per il logo */
    color: rgb(52, 3, 52) !important;
}

.nav-links {
    display: flex;
    justify-content: center;
    align-items: center; /* Allinea verticalmente gli elementi */
    list-style: none;
}

.nav-links li {
    margin: 0 15px; /* Spazio tra i link */
    color: white; /* Colore del testo */
}


.nav-links a {
    color: white;
    text-decoration: none;
    font-size: 18px;
}

.nav-links a:hover {
    text-decoration: underline; /* Sottolinea il link al passaggio del mouse */
}


        /* Main card styling */
        .main-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 800px;
            margin-top: 20px; /* Space for navbar */
            border: solid red;
        }

        .main-card {
            display: flex;
            justify-content: space-around;
            width: 100%;
            background-color: #222;
            border-radius: 10px;
            overflow: hidden;
            border: solid green;
        }
        
        /* Subcard 1 (Meta info section) */
        .subcard1 {
            flex: 1;
            background-color: #800080;
            padding: 20px;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .meta-section {
            margin-bottom: 10px;
        }
        
        .info-section button {
            padding: 10px;
            background-color: #f0f;
            border: none;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        
        /* Subcard 2 (Image) */
        .subcard2 {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #333;
        }
        
        .subcard2 img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        /* Subcard 3 (Navigation buttons) */
        .subcard3 {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 10px 15px;
            margin-top: 10px;
            background-color: #800080;
            border-radius: 6px;
        }
        
        .subcard3 button {
            padding: 10px 20px;
            background-color: #f0f;
            border: none;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main-card {
                flex-direction: column;
            }
            
            .subcard1, .subcard2 {
                width: 100%;
            }
        }

        
/* card */
.card-header {
    background-color: #716e6e;
    color: white;
    padding: 10px;
    font-size: 1.5rem;
    flex: 0;
    display: flex;
    border: solid 1px white;
}

.card-header h2 {
    font-size: 1.5rem;
    margin: 0;
    border: solid blue;
}

/* bottoni tell me more tell me less tell me even more */

button.d-none {
    display: none;
}

.button-container {
    display: flex;
    justify-content: space-between; /* Space buttons evenly */
    margin-top: 10px; /* Add space above the buttons */
    padding: 10px; /* Add padding around the buttons */
}

.button {
    background-color: #a1029e; /* Primary color */
    color: white; /* Text color */
    border: solid white; 
    padding: 10px 15px; /* Padding around the text */
    border-radius: 5px; /* Rounded corners */
    cursor: pointer; /* Pointer cursor on hover */
    transition: background-color 0.3s; /* Smooth transition for hover effect */
}

.button:hover {
    background-color: #000000; /* Darker shade on hover */ 
}

/*========================== Fine buttons ==============================*/


    </style>
</head>
<body>

    <!-- Centered Navbar -->
    <nav class="navbar">
        <ul class="nav-links">
            <li><a href="narratives.html">Narratives</a></li>
            <li><a href="map.html">Map</a></li>
          <li class="logo"><a href="index.html">Logo</a></li>
            <li><a href="#">Items</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
    </nav>
     <!-- Divider line -->
    <div class="divider"></div>

    <main>

    <!-- Main Card Container -->
    <div class="main-card-container" id="mainCard">
        <div class="card-header">
        <h2 class="text-center" id="header">ciao</h2>
    </div>
        <div class="main-card">
            <!-- Subcard 1: Meta Information -->
            <div class="subcard1">
                <div class="meta-section">
                    <h5 class="card-title text-center">Data</h5>
                    <table class="table table-striped border collapse d-md-block" id="table">
                <tbody  id="infoTable"></tbody>
            </table>
                </div>
                <div class="info-section">
                    <h5 class="card-title text-center">Info</h5>
                        <p class="card-text" id="shortInfo"></p>
                        <p class="card-text d-none" id="longerInfo"></p>
                    <button>See more</button>
                </div>
            </div>

            <!-- Subcard 2: Image -->
            <div class="subcard2">
                <img src="https://via.placeholder.com/150" alt="Object Image">
            </div>
        </div>

        <!-- Subcard 3: Navigation Buttons -->
        <div class="subcard3">
            <button id="buttonPrev">Previous</button>
            <p>ETHICS OF WAR</p>
            <button>Next</button>
        </div>
    </div>
    <div class="card d-none" id="fullInfo">
    <div class="card-header">
        <h2 class="text-center" id="fullHeader"></h2>
    </div>
  <div class="card-body" id="fullInfoContent"></div>
  <div class="card-footer d-flex justify-content-between">
    <a href="#"  type="button" class="btn btn-primary m-auto" onclick="hideFullInfo()">Back</a>
  </div>
</div>

</main>
<script>
    
var items = [];
var narratives = [];
var currentSelection = [];
var currentNarrative = "";
var currentValue = "";
var currentSort = "";

// JSON Data
document.addEventListener("DOMContentLoaded", async function(event) {
	console.log("Ready to start")
	fetch('assets/data/items.json')
	.then(response => response.json())
	.then(data => {	
		items = data.items
		var startWith = data.meta.startWith
		var item = items[startWith]

		narratives = data.meta.narratives
		currentNarrative = data.meta.startNarrative
		currentValue = data.meta.startValue
		prepareNarratives()
	})
});

function prepareNarratives() {
	currentSelection = items.filter( i => 
		i.info[currentNarrative]?.includes(currentValue) 
	)
	currentSelection.sort( (i,j) =>  
		i['@sort'] < j['@sort'] ? -1 : 1 
	)
	if (currentSelection.length==0) 
		currentSelection = items	

	var index  = currentSelection.findIndex( i => i['@sort'] == currentSort )
	if (index == -1) index = 0
	showInfo(index)
}


function showInfo(index) {
	var item = currentSelection[index]
	currentSort = item['@sort']
	inner("header",item.shortName) ;
	inner("fullHeader",item.shortName) ;
	byId("img").src = item.image
	byId("img").alt = item.shortName
	createInfoTable(item)
	inner("shortInfo",item.shortInfo + '<div class="button-container">' +
        '<a type="button" class="button" onclick="more()">Tell me more...</a>' + '</div>'); 
	inner("longerInfo","<p>"+item.longerInfo.join("</p><p>") +
    '<div class="button-container">' +
        '<a type="button" class="button" onclick="less()">Tell me less</a> or <a type="button" class="button" onclick="muchMore()">Tell me even more...</a></p>')
        + '</div>';
	byId("fullInfo").dataset['uri'] = item.fullInfo
	
	prepareNavigationButtons(index)
}

function more() {
	hide("shortInfo") ;
	show("longerInfo") ;
	hide("fullInfo") ;
}
function less() {
	hide("longerInfo") ;
	show("shortInfo") ;
	hide("fullInfo") ;
}
function muchMore() {
	var uri = byId("fullInfo").dataset['uri']
	fetch(uri)
	.then(response => response.text())
	.then(data => {	
		inner("fullInfoContent",data) ;
		hide("mainCard") ;
		show("fullInfo") ;
		window.scrollTo(0,0)
	})
}
function hideFullInfo() {
	hide("longerInfo") ;
	show("shortInfo") ;
	hide("fullInfo") ;
	show("mainCard") ;
}

function createInfoTable(item) {
	inner("infoTable","",true) ;
	for (i in item.info) {
		if (item.info[i] !== null) {
			if (narratives.includes(i)) {
				var items = item.info[i].split(", ")
				var val = []
				for (j in items) {
					val.push('<a class="button" role="button" href="#" onclick="changeNarrative(\''+i+'\',\''+items[j]+'\')">'+items[j]+'</a>')
				}
			inner("infoTable","<tr><th>"+i+"</th><td>"+val.join(", ")+"</td></tr>", false)
			} else {
				inner("infoTable","<tr><th>"+i+"</th><td>"+item.info[i]+"</td></tr>", false)
			}
		}
	}
}

function prepareNavigationButtons(index) {
    if (index > 0) {
        byId("buttonPrev").disabled = false;
        byId("buttonPrev").onclick = () => showInfo(index - 1);
        byId("buttonPrev").innerHTML = currentSelection[index - 1].shortName;        
    } else {
        byId("buttonPrev").disabled = true;
        byId("buttonPrev").onclick = null;
        byId("buttonPrev").innerHTML = "--";
    }

    if (index < currentSelection.length - 1) {
        byId("buttonNext").disabled = false;
        byId("buttonNext").onclick = () => showInfo(index + 1);
        byId("buttonNext").innerHTML = currentSelection[index + 1].shortName;
    } else {
        byId("buttonNext").disabled = true;
        byId("buttonNext").onclick = null;
        byId("buttonNext").innerHTML = "--";
    }
}

function changeNarrative(narrative,value) {
		currentNarrative = narrative
		currentValue = value
		prepareNarratives()
}

function byId(id) {
	return document.getElementById(id)
}

function show(id) {
	document.getElementById(id).classList.remove('d-none')
}

function hide(id) {
	document.getElementById(id).classList.add('d-none')
}

function inner(id,content, emptyFirst=true) {
	if(emptyFirst) document.getElementById(id).innerHTML = "" ; 
	document.getElementById(id).innerHTML += content ; 
}


// QUI INIZIA CODICE X LE NARRATIVES IN ALTO (NAVIGAZIONE BOTTONI)

// Dropdown for visualizing sub-narratives
let activeMainButton = null;
let activeSubButton = null;
let activeCurtain = null;


// Function to manage the selection of the main button and toggle the curtain
function selectMain(button) {
    // Deactivate the previously active main button
    if (activeMainButton) {
        activeMainButton.classList.remove('active');
        closeAllCurtains();  // Close any open curtain
    }
    
    // Set the clicked main button as active
    activeMainButton = button;
    button.classList.add('active');
    
    // Open the appropriate curtain based on the button
    let curtainId;
    if (button.innerText.includes('TYPOLOGY')) {
        curtainId = 'curtain-type';
    } else if (button.innerText.includes('THEMES')) {
        curtainId = 'curtain-theme';
    } else if (button.innerText.includes('HISTORICAL PERIOD')) {
        curtainId = 'curtain-period';
    }
    openCurtain(curtainId);
}

// Function to open a specific curtain
function openCurtain(curtainId) {
    closeAllCurtains();  // Close all open curtains

    // Open the selected curtain
    const curtain = document.getElementById(curtainId);
    curtain.classList.add('open');
}

// Function to close all curtains
function closeAllCurtains() {
    const curtains = document.querySelectorAll('.curtain');
    curtains.forEach(curtain => curtain.classList.remove('open'));
    curtainOpen = false;
}

// Close the curtain if clicked outside of it
document.addEventListener('click', function(event) {
    const isClickInsideCurtain = event.target.closest('.curtain');
    const isClickOnButton = event.target.closest('.main-button, .sub-tab-button');

    if (!isClickInsideCurtain && !isClickOnButton) {
        closeAllCurtains();
    }
});

// Function to select the sub-button
function selectSub(button) {
    // Deactivate the previously active sub-button
    if (activeSubButton) {
        activeSubButton.classList.remove('active');
    }
    
    // Set the clicked sub-button as active
    activeSubButton = button;
    button.classList.add('active');
}

</script>

</body>
</html>
